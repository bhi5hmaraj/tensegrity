<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: SimulationLoop Pages: 1 -->
<svg width="468pt" height="1145pt"
 viewBox="0.00 0.00 468.00 1145.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1141)">
<title>SimulationLoop</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1141 464,-1141 464,4 -4,4"/>
<text text-anchor="middle" x="230" y="-34.4" font-family="Times,serif" font-size="12.00">Discrete&#45;Time Simulation Loop</text>
<text text-anchor="middle" x="230" y="-7.4" font-family="Times,serif" font-size="12.00">Each step: Events → Actor actions → Physics update → Governance → Log</text>
<g id="clust1" class="cluster">
<title>cluster_loop</title>
<polygon fill="lightgray" stroke="lightgray" points="20.5,-365 20.5,-1042 356.5,-1042 356.5,-365 20.5,-365"/>
<text text-anchor="middle" x="188.5" y="-1026.8" font-family="Times,serif" font-size="14.00">Main Loop: for t in 1..n_steps</text>
</g>
<!-- init -->
<g id="node1" class="node">
<title>init</title>
<polygon fill="lightblue" stroke="black" points="298.5,-1137 134.5,-1137 134.5,-1069 298.5,-1069 298.5,-1137"/>
<text text-anchor="middle" x="216.5" y="-1121.8" font-family="Times,serif" font-size="14.00">Initialize State (t=0)</text>
<text text-anchor="middle" x="216.5" y="-1106.8" font-family="Times,serif" font-size="14.00">• Graph structure</text>
<text text-anchor="middle" x="216.5" y="-1091.8" font-family="Times,serif" font-size="14.00">• Field values</text>
<text text-anchor="middle" x="216.5" y="-1076.8" font-family="Times,serif" font-size="14.00">• Actor instances</text>
</g>
<!-- scheduled -->
<g id="node2" class="node">
<title>scheduled</title>
<polygon fill="lightyellow" stroke="black" points="320.5,-1011 112.5,-1011 112.5,-943 320.5,-943 320.5,-1011"/>
<text text-anchor="middle" x="216.5" y="-995.8" font-family="Times,serif" font-size="14.00">1. Apply Scheduled Events</text>
<text text-anchor="middle" x="216.5" y="-980.8" font-family="Times,serif" font-size="14.00">• DemandShock</text>
<text text-anchor="middle" x="216.5" y="-965.8" font-family="Times,serif" font-size="14.00">• NewRequirement</text>
<text text-anchor="middle" x="216.5" y="-950.8" font-family="Times,serif" font-size="14.00">• Incident</text>
</g>
<!-- init&#45;&gt;scheduled -->
<g id="edge6" class="edge">
<title>init&#45;&gt;scheduled</title>
<path fill="none" stroke="black" d="M216.5,-1068.77C216.5,-1054.31 216.5,-1037.18 216.5,-1021.71"/>
<polygon fill="black" stroke="black" points="220,-1021.32 216.5,-1011.32 213,-1021.32 220,-1021.32"/>
</g>
<!-- actors -->
<g id="node3" class="node">
<title>actors</title>
<polygon fill="lightgreen" stroke="black" points="341,-906 66,-906 66,-838 341,-838 341,-906"/>
<text text-anchor="middle" x="203.5" y="-890.8" font-family="Times,serif" font-size="14.00">2. Actor Actions (Sequential)</text>
<text text-anchor="middle" x="203.5" y="-875.8" font-family="Times,serif" font-size="14.00">for each actor:</text>
<text text-anchor="middle" x="203.5" y="-860.8" font-family="Times,serif" font-size="14.00"> &#160;action = actor.choose_action(state)</text>
<text text-anchor="middle" x="203.5" y="-845.8" font-family="Times,serif" font-size="14.00"> &#160;state = apply_event(action, state)</text>
</g>
<!-- scheduled&#45;&gt;actors -->
<g id="edge1" class="edge">
<title>scheduled&#45;&gt;actors</title>
<path fill="none" stroke="black" d="M212.32,-942.84C211.25,-934.39 210.09,-925.18 208.96,-916.3"/>
<polygon fill="black" stroke="black" points="212.4,-915.58 207.68,-906.09 205.46,-916.45 212.4,-915.58"/>
</g>
<!-- derived -->
<g id="node4" class="node">
<title>derived</title>
<polygon fill="lightcyan" stroke="black" points="348,-801 29,-801 29,-733 348,-733 348,-801"/>
<text text-anchor="middle" x="188.5" y="-785.8" font-family="Times,serif" font-size="14.00">3. Update Derived Fields</text>
<text text-anchor="middle" x="188.5" y="-770.8" font-family="Times,serif" font-size="14.00">• Recompute risk from health+complexity</text>
<text text-anchor="middle" x="188.5" y="-755.8" font-family="Times,serif" font-size="14.00">• Update badness composite</text>
<text text-anchor="middle" x="188.5" y="-740.8" font-family="Times,serif" font-size="14.00">• Recalculate flow field</text>
</g>
<!-- actors&#45;&gt;derived -->
<g id="edge2" class="edge">
<title>actors&#45;&gt;derived</title>
<path fill="none" stroke="black" d="M198.67,-837.84C197.43,-829.3 196.07,-819.98 194.76,-811.01"/>
<polygon fill="black" stroke="black" points="198.22,-810.49 193.32,-801.09 191.3,-811.49 198.22,-810.49"/>
</g>
<!-- energies -->
<g id="node5" class="node">
<title>energies</title>
<polygon fill="lavender" stroke="black" points="325,-696 82,-696 82,-613 325,-613 325,-696"/>
<text text-anchor="middle" x="203.5" y="-680.8" font-family="Times,serif" font-size="14.00">4. Compute Physics</text>
<text text-anchor="middle" x="203.5" y="-665.8" font-family="Times,serif" font-size="14.00">• V_struct = ½ bad^T L bad</text>
<text text-anchor="middle" x="203.5" y="-650.8" font-family="Times,serif" font-size="14.00">• V_bus = Σ demand × badness</text>
<text text-anchor="middle" x="203.5" y="-635.8" font-family="Times,serif" font-size="14.00">• T = ½ Σ m (Δbad)²</text>
<text text-anchor="middle" x="203.5" y="-620.8" font-family="Times,serif" font-size="14.00">• H = T + V</text>
</g>
<!-- derived&#45;&gt;energies -->
<g id="edge3" class="edge">
<title>derived&#45;&gt;energies</title>
<path fill="none" stroke="black" d="M193,-732.85C194.14,-724.44 195.39,-715.22 196.62,-706.16"/>
<polygon fill="black" stroke="black" points="200.12,-706.44 197.99,-696.06 193.18,-705.49 200.12,-706.44"/>
</g>
<!-- governance -->
<g id="node6" class="node">
<title>governance</title>
<polygon fill="mistyrose" stroke="black" points="341,-576 82,-576 82,-493 341,-493 341,-576"/>
<text text-anchor="middle" x="211.5" y="-560.8" font-family="Times,serif" font-size="14.00">5. Apply Governance Rules</text>
<text text-anchor="middle" x="211.5" y="-545.8" font-family="Times,serif" font-size="14.00">• If E_local[hub] &gt; threshold:</text>
<text text-anchor="middle" x="211.5" y="-530.8" font-family="Times,serif" font-size="14.00"> &#160;&#160;&#160;block features, require refactor</text>
<text text-anchor="middle" x="211.5" y="-515.8" font-family="Times,serif" font-size="14.00">• If H &gt; emergency_threshold:</text>
<text text-anchor="middle" x="211.5" y="-500.8" font-family="Times,serif" font-size="14.00"> &#160;&#160;&#160;pause all feature work</text>
</g>
<!-- energies&#45;&gt;governance -->
<g id="edge4" class="edge">
<title>energies&#45;&gt;governance</title>
<path fill="none" stroke="black" d="M206.25,-612.89C206.83,-604.36 207.45,-595.26 208.05,-586.41"/>
<polygon fill="black" stroke="black" points="211.56,-586.4 208.74,-576.18 204.57,-585.92 211.56,-586.4"/>
</g>
<!-- log -->
<g id="node7" class="node">
<title>log</title>
<polygon fill="wheat" stroke="black" points="333.5,-456 119.5,-456 119.5,-373 333.5,-373 333.5,-456"/>
<text text-anchor="middle" x="226.5" y="-440.8" font-family="Times,serif" font-size="14.00">6. Log State</text>
<text text-anchor="middle" x="226.5" y="-425.8" font-family="Times,serif" font-size="14.00">• All field values</text>
<text text-anchor="middle" x="226.5" y="-410.8" font-family="Times,serif" font-size="14.00">• H, T, V</text>
<text text-anchor="middle" x="226.5" y="-395.8" font-family="Times,serif" font-size="14.00">• Events that occurred</text>
<text text-anchor="middle" x="226.5" y="-380.8" font-family="Times,serif" font-size="14.00">• Governance interventions</text>
</g>
<!-- governance&#45;&gt;log -->
<g id="edge5" class="edge">
<title>governance&#45;&gt;log</title>
<path fill="none" stroke="black" d="M216.66,-492.89C217.76,-484.27 218.93,-475.07 220.06,-466.12"/>
<polygon fill="black" stroke="black" points="223.54,-466.55 221.33,-456.18 216.6,-465.66 223.54,-466.55"/>
</g>
<!-- decision -->
<g id="node8" class="node">
<title>decision</title>
<polygon fill="lightyellow" stroke="black" points="301.5,-336 204.98,-318 301.5,-300 398.02,-318 301.5,-336"/>
<text text-anchor="middle" x="301.5" y="-314.3" font-family="Times,serif" font-size="14.00">t &lt; n_steps?</text>
</g>
<!-- log&#45;&gt;decision -->
<g id="edge7" class="edge">
<title>log&#45;&gt;decision</title>
<path fill="none" stroke="black" d="M258.74,-372.88C267.13,-362.3 275.88,-351.28 283.26,-341.98"/>
<polygon fill="black" stroke="black" points="286.13,-344 289.61,-333.99 280.65,-339.64 286.13,-344"/>
</g>
<!-- decision&#45;&gt;scheduled -->
<g id="edge8" class="edge">
<title>decision&#45;&gt;scheduled</title>
<path fill="none" stroke="black" d="M321.99,-332.35C344.2,-348.61 376.5,-378.31 376.5,-413.5 376.5,-873 376.5,-873 376.5,-873 376.5,-903.41 355.82,-925.26 329.33,-940.79"/>
<polygon fill="black" stroke="black" points="327.62,-937.73 320.54,-945.61 330.99,-943.87 327.62,-937.73"/>
<text text-anchor="middle" x="389" y="-650.8" font-family="Times,serif" font-size="14.00">Yes</text>
</g>
<!-- output -->
<g id="node9" class="node">
<title>output</title>
<polygon fill="lightgreen" stroke="black" points="410.5,-249 192.5,-249 192.5,-181 410.5,-181 410.5,-249"/>
<text text-anchor="middle" x="301.5" y="-233.8" font-family="Times,serif" font-size="14.00">Output Results</text>
<text text-anchor="middle" x="301.5" y="-218.8" font-family="Times,serif" font-size="14.00">• history.csv</text>
<text text-anchor="middle" x="301.5" y="-203.8" font-family="Times,serif" font-size="14.00">• plots (H vs t, phase space)</text>
<text text-anchor="middle" x="301.5" y="-188.8" font-family="Times,serif" font-size="14.00">• field evolution JSON</text>
</g>
<!-- decision&#45;&gt;output -->
<g id="edge9" class="edge">
<title>decision&#45;&gt;output</title>
<path fill="none" stroke="black" d="M301.5,-299.87C301.5,-288.73 301.5,-273.66 301.5,-259.38"/>
<polygon fill="black" stroke="black" points="305,-259.18 301.5,-249.18 298,-259.18 305,-259.18"/>
<text text-anchor="middle" x="312" y="-270.8" font-family="Times,serif" font-size="14.00">No</text>
</g>
<!-- analysis -->
<g id="node10" class="node">
<title>analysis</title>
<polygon fill="lightblue" stroke="black" points="447.5,-144 155.5,-144 155.5,-76 447.5,-76 447.5,-144"/>
<text text-anchor="middle" x="301.5" y="-128.8" font-family="Times,serif" font-size="14.00">Analysis</text>
<text text-anchor="middle" x="301.5" y="-113.8" font-family="Times,serif" font-size="14.00">• Validate hypothesis</text>
<text text-anchor="middle" x="301.5" y="-98.8" font-family="Times,serif" font-size="14.00">• Compare governed vs unconstrained</text>
<text text-anchor="middle" x="301.5" y="-83.8" font-family="Times,serif" font-size="14.00">• Identify early warnings</text>
</g>
<!-- output&#45;&gt;analysis -->
<g id="edge10" class="edge">
<title>output&#45;&gt;analysis</title>
<path fill="none" stroke="black" d="M301.5,-180.84C301.5,-172.39 301.5,-163.18 301.5,-154.3"/>
<polygon fill="black" stroke="black" points="305,-154.09 301.5,-144.09 298,-154.09 305,-154.09"/>
</g>
</g>
</svg>
